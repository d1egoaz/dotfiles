# AeroSpace configuration
# Moved from nix-darwin service to Home Manager with direct symlink for editing

# Config version for compatibility and deprecations
# Fallback value (if you omit the key): config-version = 1
config-version = 2

# Enable/disable features
enable-normalization-flatten-containers = true
enable-normalization-opposite-orientation-for-nested-containers = true

# Layout settings
accordion-padding = 40
default-root-container-layout = "tiles"
default-root-container-orientation = "auto"
automatically-unhide-macos-hidden-apps = true

# Startup/execution settings
start-at-login = false

# Commands to run after startup
after-startup-command = [
  "exec-and-forget sketchybar --config ~/.config/sketchybar/sketchybarrc",
  "exec-and-forget borders"
]

# Workspace change notifications
exec-on-workspace-change = [
  "/bin/bash",
  "-c",
  "sketchybar --trigger aerospace_workspace_change FOCUSED_WORKSPACE=$AEROSPACE_FOCUSED_WORKSPACE",
]

# Monitor focus behavior
on-focused-monitor-changed = ["move-mouse monitor-lazy-center"]

# like in i3, all workspaces are phantom
persistent-workspaces = []

# Execution environment settings
[exec]
inherit-env-vars = true

[exec.env-vars]
PATH = "/etc/profiles/per-user/${USER}/bin:${PATH}"

# Key mapping preset
[key-mapping]
preset = "qwerty"

# Gaps configuration
[gaps.inner]
horizontal = 2
vertical = 2

[gaps.outer]
left = 3
right = 3
bottom = 2
# Different top gaps for different monitors
top = [{ monitor."LG" = 40 }, { monitor."^built-in retina display$" = 15 }, 30]

# Main mode bindings
[mode.main.binding]
# Terminal and config
# alt-enter = "exec-and-forget open -n -a Wezterm"
alt-enter = "exec-and-forget open -n -a /Applications/Ghostty.app/Contents/MacOS/ghostty"
alt-shift-r = "reload-config"
alt-r = "mode resize"

# Layout commands
alt-slash = "layout tiles horizontal vertical"
alt-comma = "layout accordion horizontal vertical"

# Focus commands
alt-h = "focus --boundaries-action wrap-around-the-workspace left"
alt-j = "focus --boundaries-action wrap-around-the-workspace down"
alt-k = "focus --boundaries-action wrap-around-the-workspace up"
alt-l = "focus --boundaries-action wrap-around-the-workspace right"

# Move commands
alt-shift-h = "move left"
alt-shift-j = "move down"
alt-shift-k = "move up"
alt-shift-l = "move right"

# Resize commands
alt-minus = "resize smart -50"
alt-equal = "resize smart +50"

# Workspace navigation
alt-3 = "workspace 3"
alt-9 = "workspace 9"
alt-a = "workspace AI"
alt-c = "workspace Chrome"
alt-e = "workspace Emacs"
alt-i = "workspace IDEs"
alt-t = "workspace Terminal"

# Office-specific workspaces
alt-n = "workspace Notion"
alt-s = "workspace Slack"
alt-z = "workspace Zoom"

# Move to workspace
alt-shift-3 = ["move-node-to-workspace 3", "workspace 3"]
alt-shift-9 = ["move-node-to-workspace 9", "workspace 9"]
alt-shift-a = ["move-node-to-workspace AI", "workspace AI"]
alt-shift-c = ["move-node-to-workspace Chrome", "workspace Chrome"]
alt-shift-e = ["move-node-to-workspace Emacs", "workspace Emacs"]
alt-shift-i = ["move-node-to-workspace IDEs", "workspace IDEs"]
alt-shift-t = ["move-node-to-workspace Terminal", "workspace Terminal"]

# Office-specific move bindings
alt-shift-n = ["move-node-to-workspace Notion", "workspace Notion"]
alt-shift-s = ["move-node-to-workspace Slack", "workspace Slack"]
alt-shift-z = ["move-node-to-workspace Zoom", "workspace Zoom"]

# Workspace switching
alt-tab = "workspace-back-and-forth"
alt-shift-tab = "move-workspace-to-monitor --wrap-around next"

# Mode switching
alt-shift-semicolon = "mode service"

# Service mode bindings
[mode.service.binding]
esc = ["reload-config", "mode main"]
r = ["flatten-workspace-tree", "mode main"]
f = ["layout floating tiling", "mode main"]
backspace = ["close-all-windows-but-current", "mode main"]

# Join commands
alt-shift-h = ["join-with left", "mode main"]
alt-shift-j = ["join-with down", "mode main"]
alt-shift-k = ["join-with up", "mode main"]
alt-shift-l = ["join-with right", "mode main"]

# Volume controls
down = "volume down"
up = "volume up"
shift-down = ["volume set 0", "mode main"]

# Resize mode bindings
[mode.resize.binding]
h = "resize width -50"
j = "resize height +50"
k = "resize height -50"
l = "resize width +50"
enter = "mode main"
esc = "mode main"

# Window detection rules
[[on-window-detected]]
if.app-id = "com.google.Chrome"
run = "move-node-to-workspace Chrome"

[[on-window-detected]]
if.app-id = "org.gnu.Emacs"
run = "move-node-to-workspace Emacs"

[[on-window-detected]]
if.app-name-regex-substring = "emacs.*"
run = "move-node-to-workspace Emacs"

# Terminal apps
[[on-window-detected]]
if.app-id = "com.googlecode.iterm2"
run = "move-node-to-workspace Terminal"

[[on-window-detected]]
if.app-id = "com.github.wez.wezterm"
run = "move-node-to-workspace Terminal"

[[on-window-detected]]
if.app-id = "com.mitchellh.ghostty"
run = ["layout tiling", "move-node-to-workspace Terminal"]

# AI apps
[[on-window-detected]]
if.app-id = "com.openai.chat"
run = "move-node-to-workspace AI"

[[on-window-detected]]
if.app-name-regex-substring = "ChatGPT"
run = "move-node-to-workspace AI"

[[on-window-detected]]
if.app-name-regex-substring = "Gemini"
run = "move-node-to-workspace AI"

[[on-window-detected]]
if.app-name-regex-substring = "AI diegoa"
run = "move-node-to-workspace AI"

[[on-window-detected]]
if.app-name-regex-substring = "Perplexity"
run = "move-node-to-workspace AI"

[[on-window-detected]]
if.app-name-regex-substring = "Hyprnote"
run = "move-node-to-workspace AI"

[[on-window-detected]]
if.app-id = "ai.perplexity.mac"
run = "move-node-to-workspace AI"

[[on-window-detected]]
if.app-id = "ai.elementlabs.lmstudio"
run = "move-node-to-workspace AI"

# Office apps
[[on-window-detected]]
if.app-id = "notion.id"
run = "move-node-to-workspace Notion"

[[on-window-detected]]
if.app-id = "com.tinyspeck.slackmacgap"
run = "move-node-to-workspace Slack"

[[on-window-detected]]
if.app-name-regex-substring = "Slack"
run = "move-node-to-workspace Slack"

[[on-window-detected]]
if.app-id = "us.zoom.xos"
run = "move-node-to-workspace Zoom"

# 1Password
#[[on-window-detected]]
#if.app-id = "com.1password.1password"
#run = "move-node-to-workspace 9"

[[on-window-detected]]
if.window-title-regex-substring = "Lock Screen â€” 1Password"
run = "move-node-to-workspace 9"

# IDEs
[[on-window-detected]]
if.app-id = "com.todesktop.230313mzl4w4u92" # Cursor
run = "move-node-to-workspace IDEs"

[[on-window-detected]]
if.app-id = "com.microsoft.VSCode"
run = "move-node-to-workspace IDEs"

# Floating apps
[[on-window-detected]]
if.app-id = "au.csiro.dialog"
run = ["layout tiling", "move-node-to-workspace 3"]

[[on-window-detected]]
if.app-id = "cc.ffitch.shottr"
run = "layout floating"

[[on-window-detected]]
if.app-id = "com.apple.ActivityMonitor"
run = "layout floating"

[[on-window-detected]]
if.app-id = "com.apple.Preview"
run = "layout floating"

[[on-window-detected]]
if.app-id = "com.apple.QuickTimePlayerX"
run = "layout floating"

[[on-window-detected]]
if.app-id = "com.apple.SecurityAgent"
run = "layout floating"

[[on-window-detected]]
if.app-id = "com.apple.finder"
run = "layout floating"

[[on-window-detected]]
if.app-id = "com.pais.handy"
run = "layout floating"

[[on-window-detected]]
if.app-id = "ca.diegoa.narro"
run = "layout floating"

[[on-window-detected]]
if.app-id = "net.sonuscape.mouseless"
run = "layout floating"

[[on-window-detected]]
if.app-id = "com.apple.systempreferences"
run = "layout floating"

[[on-window-detected]]
if.app-id = "com.okta.mobile"
run = "layout floating"

[[on-window-detected]]
if.app-id = "tv.plex.plexamp"
run = "layout floating"

[[on-window-detected]]
if.window-title-regex-substring = "Alfred Preferences"
run = "layout floating"

# Catch-all tiling rule
[[on-window-detected]]
if.app-name-regex-substring = ".*"
run = "layout floating"
#if.app-name-regex-substring = ".*"
#run = ["layout tiling", "move-node-to-workspace 3"]
